sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/m/ColumnListItem","sap/m/Label","sap/m/Token","sap/m/SearchField","sap/m/MessageBox","sap/ui/core/message/Message","sap/ui/core/BusyIndicator","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/ValueState","sap/ui/model/Sorter"],function(e,t,r,o,s,n,a,i,l,g,u,p,d,h){"use strict";var c;return e.extend("com.reckitt.zpeworklist.controller.BaseController",{onInit:function(){c=this.getOwnerComponent().getModel("i18n").getResourceBundle()},getUserParameters:function(){g.show();var e=this.getOwnerComponent().getModel("filterModel");var t=this.getOwnerComponent().getModel("oDataSearchModel");t.read("/UserPlantSet",{success:$.proxy(function(t){e.setProperty("/Plant",t.results[0].Plant);e.refresh();sap.ui.core.BusyIndicator.hide();this.getWorkCenterSHSet()},this),error:$.proxy(function(e){g.hide()})})},getWorkCenterSHSet:function(){g.show();var e=[];var t=this.getOwnerComponent().getModel("filterModel");var r=this.getOwnerComponent().getModel("oDataSearchModel");var o=this.getOwnerComponent().getModel("CommonValueHelpModel");if(t.getProperty("/Plant").length!=0){e.push(new u("Werks",p.EQ,t.getProperty("/Plant")))}r.read("/WorkCenterSHSet",{filters:e,success:$.proxy(function(e){var t=[];e.results.forEach(function(e){var r={Arbpl:e.Arbpl,Ktext:e.Ktext,Werks:e.Werks};t.push(r)});o.setProperty("/WorkCenter",t);o.refresh();g.hide()},this),error:$.proxy(function(e){g.hide()})})},fnValueHelpDialog:function(e,i,l,g){var u=this;this._oBasicSearchField=new a({showSearchButton:false,liveChange:function(t){sap.ui.core.BusyIndicator.show();var r=[];var o=t.getSource().getValue();var s=[];var n=[];l.cols.forEach(function(e){var t=new sap.ui.model.Filter(e.template,sap.ui.model.FilterOperator.Contains,o);s.push(t)});var a={};a[i]=g;u.oVHModel.setData(a);u._oValueHelpDialog.getTableAsync().then(function(e){e.setModel(u.oVHModel);e.setModel(u.oColModel,"columns");if(e.bindRows){e.bindAggregation("rows","/"+i)}u._oValueHelpDialog.update()}.bind(u));e.setModel(this.oVHModel);var p=new sap.ui.model.Filter(s,false);var d=t.getSource().getParent().getParent().getParent().getItems()[1].getBinding("rows");d.filter(p);sap.ui.core.BusyIndicator.hide()}});this._oInput=e;this.oColModel=new t;this.oColModel.setData(l);var p=this.oColModel.getData().cols;this.oVHModel=new t;var d={};d[i]=g;this.oVHModel.setData(d);e.setModel(this.oVHModel);r.load({name:"com.reckitt.zpeworklist.view.Fragments.ValueHelpDialog",controller:this}).then(function(e){this._oValueHelpDialog=e;if(i==="WorkCenterSHSet"){this._oValueHelpDialog.setSupportMultiselect(true)}this.getView().addDependent(this._oValueHelpDialog);this._oValueHelpDialog.getFilterBar().setBasicSearch(this._oBasicSearchField);this._oValueHelpDialog.getFilterBar().setShowGoOnFB(false);this._oValueHelpDialog.getTableAsync().then(function(e){this._oValueHelpDialog.setTokens([]);var t=this.getView().byId("idWorkCenter").getTokens();this._oValueHelpDialog.setTokens(t);e.setModel(this.oVHModel);e.setModel(this.oColModel,"columns");if(e.bindRows){e.bindAggregation("rows","/"+i)}if(e.bindItems){e.bindAggregation("items","/"+i,function(){return new o({cells:p.map(function(e){return new s({text:"{"+e.template+"}"})})})})}this._oValueHelpDialog.update()}.bind(this));var t=new n;t.setKey(this._oInput.getSelectedKey());t.setText(this._oInput.getValue());this._oValueHelpDialog.setTokens([t]);this._oValueHelpDialog.open()}.bind(this))},onVHOK:function(e){var t=e.getParameter("tokens");var r=this.getView().byId("idWorkCenter");this._oInput.setTokens(t);this._oValueHelpDialog.close()},onVHCancel:function(){this._oValueHelpDialog.close()},onVHAfterClose:function(){this._oValueHelpDialog.destroy()},fnFilterValues:function(){var e=this.getOwnerComponent().getModel("i18n").getResourceBundle();var t=[];var r=this.getOwnerComponent().getModel("filterModel");var o=this.getView().byId("idWorkCenter").getTokens();var s=[];var n=r.getProperty("/CRTD");var a=r.getProperty("/REL");var i=r.getProperty("/TECO");if(n){s.push(e.getText("txtCRTD"))}if(a){s.push(e.getText("txtREL"))}if(i){s.push(e.getText("txtTECO"))}var l=s.toString();if(l.length>0){t.push(new u("SysStatus",p.EQ,l))}if(r.getProperty("/Plant").length>0){t.push(new u("Werks",p.EQ,r.getProperty("/Plant")))}$.each(o,function(e,r){if(r.data().range===undefined){t.push(new u("Arbpl",sap.ui.model.FilterOperator.EQ,r.getKey()))}});if(r.getProperty("/StartDateFrom").length>0){t.push(new u("RelSdateFrom",p.EQ,r.getProperty("/StartDateFrom")))}if(r.getProperty("/StartDateTo").length>0){t.push(new u("RelSdateTo",p.EQ,r.getProperty("/StartDateTo")))}return t},fnvalidationST:function(){var e=this.getOwnerComponent().getModel("filterModel").getData().StorageType;if(e.length===0){return false}else{return true}},fnValidateHeader:function(){var e=this.getOwnerComponent().getModel("filterModel").getData();var t=this.getOwnerComponent().getModel("AppModeModel");var r=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.fnResetValidationError(t);if(e.Plant.length===0){t.setProperty("/errorVisible",true);this.fnInsertErrorMessage(r.getText("errTxtPlant"));t.setProperty("/vsPlantErrorText",r.getText("errTxtPlant"));t.setProperty("/vsPlant",d.Error)}if(e.WorkCenter.length!==0){t.setProperty("/errorVisible",true);this.fnInsertErrorMessage(r.getText("errTxtWorkCenter1"));t.setProperty("/vsWorkCenterErrorText",r.getText("errTxtWorkCenter1"));t.setProperty("/vsWorkCenter",d.Error)}if(e.CRTD===false&&e.REL===false&&e.TECO===false){t.setProperty("/errorVisible",true);this.fnInsertErrorMessage(r.getText("errTxtStatus"));t.setProperty("/vsStatusErrorText",r.getText("errTxtStatus"));t.setProperty("/vsStatus",d.Error)}if(this.getView().byId("idWorkCenter").getTokens().length===0){t.setProperty("/errorVisible",true);this.fnInsertErrorMessage(r.getText("errTxtWorkCenter1"));t.setProperty("/vsWorkCenter1ErrorText",r.getText("errTxtWorkCenter1"));t.setProperty("/vsWorkCenter1",d.Error)}if(Number(e.StartDateFrom)>Number(e.StartDateTo)&&e.StartDateTo!==""){t.setProperty("/errorVisible",true);i.error(r.getText("errTxtdata"))}if(t.getProperty("/errorVisible")===true){return false}else{return true}},fnResetValidationError:function(e){sap.ui.getCore().getMessageManager().removeAllMessages();e.setProperty("/errorVisible",false);e.setProperty("/errorText","");e.setProperty("/vsWorkCenter",d.None);e.setProperty("/vsWorkCenter1",d.None);e.setProperty("/vsStatus",d.None);e.setProperty("/vsPlant",d.None);e.refresh()},fnInitMessageManager:function(){var e,r,o;o=this.getView();e=sap.ui.getCore().getMessageManager();this.getOwnerComponent().setModel(e.getMessageModel(),"message");e.registerObject(o,true);r=new t({MandatoryInputValue:"",DateValue:null,IntegerValue:undefined,Messages:""});o.setModel(r)},fnInsertErrorMessage:function(e){var t=this.getOwnerComponent().getModel("i18n").getResourceBundle();var r=new l({message:e,type:t.getText("lblError"),target:"/Messages",processor:this.getView().getModel()});sap.ui.getCore().getMessageManager().addMessages(r)},fnResetErrorMessage:function(){this.getOwnerComponent().getModel("message").setData([])},sortCategories:function(){if(!this.FilterDialog){this.FilterDialog=sap.ui.xmlfragment("com.reckitt.zpeworklist.view.Fragments.column",this);this.getView().addDependent(this.FilterDialog)}this.FilterDialog.open()},handleSortConfirm:function(e){var t=this.byId("WorkListTable"),r=e.getParameters(),o=t.getBinding("items"),s,n,a=[];s=r.sortItem.getKey();n=r.sortDescending;a.push(new h(s,n));o.sort(a);this.onAfterDialogClose()},onDialogClose:function(e){e.getSource().getParent().close()},onOK:function(e){var t=e.getSource().getParent().getContent()[0].getSelectedContextPaths();var r=this.getOwnerComponent().getModel("SearchableColumnsModel");var o=this.byId("WorkListTable");r.getProperty("/columns").forEach(function(e){e.status=false});t.forEach(function(e,t){r.setProperty(e+"/status",true)});var s=o.getColumns();s.forEach(function(e,t){var o=r.getProperty("/columns")[t];e.setVisible(o.status)});e.getSource().getParent().close()},onAfterDialogClose:function(e){this.FilterDialog=undefined}})});
//# sourceMappingURL=BaseController.js.map