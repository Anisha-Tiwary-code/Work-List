sap.ui.define(["./BaseController","sap/ui/core/mvc/Controller","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/table/TablePersoController","../utils/DemoPersoService","../custom/customVariant","sap/m/MessageBox","sap/ui/core/BusyIndicator","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Dialog","com/reckitt/zpeworklist/model/formatter"],function(e,t,a,r,n,i,o,s,l,d,u,g){"use strict";return e.extend("com.reckitt.zpeworklist.controller.WorkToList",{formatter:g,_oSmartVariantManagement:null,_oTPC:null,_customVariant:null,onInit:function(){this._oSmartVariantManagement=this.byId("pageVariantId1");this.getUserParameters();var e=sap.ui.core.UIComponent.getRouterFor(this);e.attachRouteMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=new sap.ui.core.routing.HashChanger;var a=t.getHash();if(a!=="undefined"&&a!==""){var r=/(?:sap-iapp-state=)([^&=]+)/.exec(a);if(r!==null){var n=r[1];sap.ushell.Container.getService("CrossApplicationNavigation").getAppState(this.getOwnerComponent(),n).done(function(e){this.getView().getModel("filterModel").setData(e.getData());var t=this.getView().getModel("filterModel");this.getView().byId("idWorkCenter").setTokens([]);if(t.getProperty("/tokens")!=undefined){for(let e=0;e<t.getProperty("/tokens").length;e++){var a=new sap.m.Token({text:t.getProperty("/tokens")[e],key:t.getProperty("/tokens")[e]});this.byId("idWorkCenter").addToken(a)}}this.getView().getModel("filterModel").refresh();this.onSearch()}.bind(this))}}},onBeforeRendering:function(){if(this.getView().byId("customVariant")!==undefined){this.getView().byId("customVariant").destroy()}this._customVariant=new i(this.createId("customVariant"),{persistencyKey:"commanKey"})},onAfterRendering:function(){var e=new a({keyName:"persistencyKey",type:"table"});e.setControl(this._customVariant);this._oSmartVariantManagement.addPersonalizableControl(e);this._oSmartVariantManagement.initialise(function(){this._oSmartVariantManagement.currentVariantSetModified(false)}.bind(this),this._customVariant);this._customVariant.registerFetchData(this.onVariantFetchData.bind(this));this._customVariant.registerApplyData(this.onVariantApplyData.bind(this))},onVariantFetchData:function(){var e=this;var t=this.byId("idWorkCenter").getTokens();var a=[];t.forEach(function(e){a.push(e.getKey())});return{InputValue1:{Plant:this.byId("idPlant").getValue(),WorkCenter:a,StartDateTo:this.byId("idStartDateTo").getValue(),StartDateFrom:this.byId("idStartDateFrom").getValue(),CRTD:this.byId("cb1").getProperty("selected"),REL:this.byId("cb2").getProperty("selected"),TECO:this.byId("cb3").getProperty("selected")}}},onVariantApplyData:function(e){this.byId("cb1").setProperty("selected",e.InputValue1.CRTD);this.byId("cb2").setProperty("selected",e.InputValue1.REL);this.byId("cb3").setProperty("selected",e.InputValue1.TECO);this.byId("idStartDateFrom").setValue(e.InputValue1.StartDateFrom);this.byId("idStartDateTo").setValue(e.InputValue1.StartDateTo);this.byId("idPlant").setValue(e.InputValue1.Plant);this.byId("idWorkCenter").setTokens([]);if(e.InputValue1.WorkCenter!=undefined){for(let a=0;a<e.InputValue1.WorkCenter.length;a++){var t=new sap.m.Token({text:e.InputValue1.WorkCenter[a],key:e.InputValue1.WorkCenter[a]});this.byId("idWorkCenter").addToken(t)}}},onVHWorkCenter:function(e){var t=e.getSource();var a=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.getOwnerComponent().getModel("VHKeyModel").setProperty("/Title",a.getText("lblWorkCenter"));this.getOwnerComponent().getModel("VHKeyModel").setProperty("/key","Arbpl");this.getOwnerComponent().getModel("VHKeyModel").setProperty("/descriptionKey","Ktext");var r=this.getOwnerComponent().getModel("ColumnModel").getObject("/workcenter");var n=this.getOwnerComponent().getModel("CommonValueHelpModel").getObject("/WorkCenter");var i="WorkCenterSHSet";this.fnValueHelpDialog(t,i,r,n)},handleVaraintModification:function(e){this._oSmartVariantManagement.currentVariantSetModified(e)},onlivechange:function(e){var t=this.getView().byId(e.oSource.getId().split("WorkToList--")[1]);if(t.getValue().length>2){if(t.getValue().slice(0,1)==="+"||t.getValue().slice(0,1)==="-"){t.setValue(t.getValue().slice(0,3))}else{t.setValue(t.getValue().slice(0,2))}}},onSearch:function(){this.getOwnerComponent().getModel("TableModel").setData([]);if(this.fnValidateHeader()===true){s.show(0);var e=this.fnFilterValues();var t=this;var a=this.getOwnerComponent().getModel("oDataWorkListModel");a.read("/OrderInfoOperSet",{filters:e,success:$.proxy(function(e,a){if(a.statusCode===200||a.statusCode==="200"){if(e.results.length>0){var r=e.results;t.getOwnerComponent().getModel("TableModel").setData(r);s.hide()}else{var n=this.getOwnerComponent().getModel("i18n").getResourceBundle();o.warning(n.getText("lblNoDataFound"));s.hide()}}s.hide()},this),error:$.proxy(function(e){var t=e.message;MessageToast.show(t);s.hide()},this)})}},onSearchableColumns:function(){if(!this.FilterDialog){this.FilterDialog=sap.ui.xmlfragment("com.reckitt.zpeworklist.view.Fragments.searchableColumns",this);this.getView().addDependent(this.FilterDialog)}this.FilterDialog.open()},onLiveTableSearch:function(e){var t=e.getSource().getValue();var a=[];var r=this.getOwnerComponent().getModel("SearchableColumnsModel");r.getProperty("/columns").forEach(function(e,r){if(e.status===true){a.push(new l(e.key,d.Contains,t))}});var n=new l({filters:a});var i=e.getSource().getParent().getParent().getBinding("items");i.filter(n)},onchangePlant:function(){var e=this.getView().byId("idPlant");e.setValue(e.getValue().toUpperCase())},onPlantChange:function(e){var t=this.getView().byId("idPlant");t.setValue(t.getValue().toUpperCase());this.getWorkCenterSHSet()},onSelectItem:function(e){var t=e.getSource().getSelectedContextPaths()[0];var a=this.getView().getModel("TableModel").getObject(t);var r=a.Aufnr;var n=this.getView().byId("idWorkCenter").getTokens();var i=[];n.forEach(function(e){i.push(e.getKey())});this.getView().getModel("filterModel").setProperty("/tokens",i);var o=sap.ushell.Container.getService("CrossApplicationNavigation");var s=o.createEmptyAppState(this.getOwnerComponent());s.setData(this.getView().getModel("filterModel").getData());s.save();var l=new sap.ui.core.routing.HashChanger.getInstance;var d=l.getHash().split("?sap-iapp-state")[0];var u=d+"?"+"sap-iapp-state="+s.getKey();l.replaceHash(u);var g=o&&o.hrefForExternal({target:{semanticObject:"zpe_disp_rel_order",action:"display"},appSpecificRoute:r,appStateKey:s.getKey()})||"";o.toExternal({target:{shellHash:g}})}})});
//# sourceMappingURL=WorkToList.controller.js.map